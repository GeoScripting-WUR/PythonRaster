---
author: "Jan Verbesselt, Jorge Mendes de Jesus, Aldo Bergsma, Dainius Masiliunas, David Swinkels"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  knitrBootstrap::bootstrap_document:
    title: "Week 3: Python for geo-scripting"
    theme: "simplex"
    highlight: Tomorrow Night Bright
    menu: FALSE
    theme.chooser: TRUE
    highlight.chooser: TRUE
---

# [WUR Geoscripting](https://geoscripting-wur.github.io/) ![WUR logo](https://www.wur.nl/upload/b43b7095-e452-482a-8969-fed9a50393a8_WUR_RGB_standard.png)

_Jan Verbesselt, Jorge Mendes de Jesus, Aldo Bergsma, Dainius Masiliunas, David Swinkels_ - `r format(Sys.time(), '%d %B, %Y')`

# Handling Raster data with Python

## Intro

Howdy. Good morning. Today we will be playing with Python packages for spatial raster analysis.
Python has some dedicated packages to handle rasters:

* [Rasterio](https://rasterio.readthedocs.io/en/latest/) focuses on raster analysis
* [PyProj](https://github.com/jswhit/pyproj) for re-projecting
* [NumPy](http://www.numpy.org/) is fundamental package for scientific computing, such as array calculations
* [matplotlib](https://matplotlib.org/) for plotting
* [GDAL](https://en.wikipedia.org/wiki/GDAL) is powerful library for reading, writing and warping raster datasets
* [PySAL](https://pysal.readthedocs.io/en/latest/) is library for spatial analysis functions
* [descartes](https://pypi.org/project/descartes/#description) is library to plot geometric objects as matplotlib paths and patches

```{r, engine = 'python', eval=FALSE}
conda create -n rasterpython python=3.6 pip
source activate rasterpython
pip install rasterio geopandas rasterstats matplotlib owslib pysal descartes

```

Before Rasterio there was one Python option for accessing the many different kind of raster data files used in the GIS field: the Python bindings distributed with the Geospatial Data Abstraction Library [GDAL]. These bindings extend Python, but provide little abstraction for GDAL’s C API. This means that Python programs using them tend to read and run like C programs. For example, GDAL’s Python bindings require users to watch out for dangling C pointers, potential crashers of programs. This is bad: among other considerations Rasterio chose Python instead of C to avoid problems with pointers. Rasterio strives to use modern Python language features and idioms. Rasterio is about high performance, lower cognitive load, cleaner and more transparent code ([source](https://rasterio.readthedocs.io/en/latest/intro.html)).

## Dataset

The data set for the raster python session can be downloaded from:
https://www.dropbox.com/s/rsc4lzkd3t2adq5/ospy_data5.zip?dl=0

Data is also available from http://www.gis.usu.edu/~chrisg/python/2009/lectures/


## Reading, analyzing, and writing raster data

See here for a full [reproducible Python outline](http://nbviewer.ipython.org/github/GeoScripting-WUR/PythonWeek/blob/gh-pages/Raster%20data%20handling.ipynb).

An interesting www to check out if something unexpected occurs:
http://trac.osgeo.org/gdal/wiki/PythonGotchas

### Via Python

```{r, engine = 'python', eval=FALSE}
# import modules
from osgeo import gdal
from osgeo.gdalconst import GA_ReadOnly, GDT_Float32
import numpy as np

# open file and print info about the file
# the ¨../¨ refers to the parent directory of my working directory
filename = 'data/ospy_data5/aster.img'
dataSource = gdal.Open(filename, GA_ReadOnly)

print "\nInformation about " + filename 
print "Driver: ", dataSource.GetDriver().ShortName,"/", \
      dataSource.GetDriver().LongName

```

# Assignment

For this scripting challenge I have downloaded a Landsat image with all bands process to surface reflectance (Level 1T). You can download it from [here](https://www.dropbox.com/s/zb7nrla6fqi1mq4/LC81980242014260-SC20150123044700.tar.gz?dl=0). Unzip the file and you will see that it contains all the invidual bands. 

Now, write a well-structured and documented script where you define a function to derive the NDWI and derive it from the landsat image and reproject the image to Lat/Long WGS84 (`x.ImportFromEPSG(4326)`).

`NDWI = band 4 - band 5 / band 4 + band 5` ([more info about](http://nsidc.org/data/docs/daac/nsidc0332_smex03_srs_ndvi_ndwi_ok.gd.html) `NDWI`)

A clean and well structured script is critical here.

## Deadline

Upload your documented and well structured Python script to a GitLab repository.

## Landsat data

You can easily order landsat data via:

  * https://earthexplorer.usgs.gov/
  
Once the have the Landsat ID you can order further processed data (e.g. resampled, or as geotif, etc.) via:

  * http://espa.cr.usgs.gov/index/
